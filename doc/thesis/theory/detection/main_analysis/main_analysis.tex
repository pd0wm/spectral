%!TEX program = xelatex

\documentclass[a4paper, openany, oneside]{memoir}
\input{../../../../includes/preamble.tex}
\addbibresource{../../../../includes/bibliography.bib}

\begin{document}

% http://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=6068200
\section{Main analysis}

Let $x[n]$ denote the received signal. 

The algorithm must decide between to hypotheses:

\begin{align}\label{eq:hypotheses}
  \mathcal{H}_0&: x[n] = w[n]\\
  \mathcal{H}_1&: x[n] = s[n] + w[n]
\end{align}

in which $w[n]$ denotes additive circular complex gaussian noise and $s[n]$ denotes a signal as transmitted by a primary user.

\subsection{Energy Detection}
We assume that the noise samples are i.i.d. zero mean circular complex gaussian distributed; $w[n] \sim \mathcal{CN}(0, \sigma_n^2)$. 
We furthermore assume that the samples of the signal $s[n]$ can be modelled independently as circular complex gaussian $\mathcal{CN}(0, \sigma_s^2)$. % todo ref
% dat dit aannemelijk maakt That is

\begin{align*}
x[n] \sim 
    \begin{cases}
        \mathcal{CN}(0, \sigma_n^2) & \text{under $\mathcal{H}_0$} \\
        \mathcal{CN}(0, (\sigma_s^2 + \sigma_n^2)) & \text{under $\mathcal{H}_1$}
    \end{cases}
\end{align*} 

Let $\vec{x} = \left[x[0], x[1], \ldots, x[N-1]\right]^T$ denote a vector containing $N$ samples of the signal $x$. Then the likelihood function of $\vec{x}$ denotes as $L(\vec{x})$ is given by:

\begin{align*}
    L(\vec{x}) &= \prod_{i=1}^N f_{(\vec{x})_i}\\
    &= \begin{cases}
        \frac{\sigma_n^2}{\pi^N } \exp(-\bar{\vec{x}}'\sigma_n^2\mathbf{I}\vec{x}) & \text{under $\mathcal{H}_0$} \\
        \frac{\sigma_n^2}{\pi^N } \exp(-\bar{\vec{x}}'(\sigma_n^2+\sigma_s^2)\mathbf{I}\vec{x}) & \text{under $\mathcal{H}_1$}
    \end{cases}
\end{align*}

Where $f_{(\vec{x})_i}$ denotes the probability density function of element $i$ in $\vec{x}$.  The test statistic $\Lambda(\vec{x})$ as used in the Neyman Pearson test is then given by:
\begin{align*}
\Lambda(\vec{x}) &=\frac{\frac{\sigma_n^2}{\pi^N } \exp(-\bar{\vec{x}}'\sigma_n^2\mathbf{I}\vec{x})}{\frac{(\sigma_n^2 + \sigma_s^2)}{\pi^N } \exp(-\bar{\vec{x}}'(\sigma_n^2+\sigma_s^2)\mathbf{I}\vec{x})}
\end{align*}


By taking the logarithm of $\Lambda(x)$ we obtain a Log Likelihood Ratio test statistic $\Lambda'(x)$, given by

\begin{align*}
\Lambda(\vec{x}) &= \log \left(
\frac{\sigma_n^2\exp(-\overline{\vec{x}}'\sigma_n^2\mathbf{I}\vec{x})}{(\sigma_n^2 + \sigma_s^2)\exp(-\bar{\vec{x}}'(\sigma_n^2+\sigma_s^2)\mathbf{I}\vec{x})}\right) \\
&= \log\left(\sigma_n^2\right) - \log\left(\sigma_n^2 + \sigma_s^2\right) +  (\sigma_s^2) \sum_{i=0}^{N-1} |x[i]|^2. 
\end{align*}

Observing that the constants $\sigma_n$ and $\sigma_s$ do not depend on value of the samples, the test statistic 

\begin{align*}
\Lambda''(\vec{x}) &= \frac{\sum_{i=0}^{N-1} |x|^2}{N}
\end{align*} 

is proportional to $\Lambda'(x)$. A detector using the test statistic $\Lambda''(x)$ is  referred to as the \emph{Energy detector}. 

\subsubsection{Threshold}
In this section we will determine the threshold $\eta$, for the energy detector test statistic $\Lambda''(x)$.
%Without loss of generality, let $\sigma_n = N^2$ \footnote{To determine the threshold $\eta$ for $\sigma_n \neq N^2$, observe that we can normalize $(\vec{x})_i$, by dividing it by its standard deviation $\sigma_n$.}. 
Under $\mathcal{H}_0$ the following applies\cite{teguigspectrum2014}  

\begin{align}
    \frac{\Lambda''(x)N}{2\sigma_n^2} \sim \chi^2_{2N}.
\end{align}

% Sensing Throughput Tradeoff in Cognitive Radio, Y. C. Liang

Therefore the false alarm probability $P_{fa}$ is given by \cite{rugini2013small}:

\begin{align*}
    P_{fa} &= P\left[(\Lambda''(\vec{x}) > \eta)\right] \\
        &= 1-F_{2N} (\frac{\eta N}{2\sigma_n^2})
\end{align*}

with $F_{2N}$ the CDF of a chi square distribution with $2N$ degrees of freedom. 

If $N$ is large enough, we can approximate the test statistics' distribution by a gaussian distribution, using the Central Limit theorem:

\begin{align*}
F_{2N} \approx 1-Q(\frac{\frac{\Lambda''(x)N}{2\sigma^2_n}-2N}{2\sqrt{N}}).
\end{align*}

$P_{fa}$ can then be approximated as 

 \begin{align}
 P_{fa} \approx Q\left(\frac{\frac{\eta N}{2\sigma_n^2} -2N}{2\sqrt{N}}\right).\label{eq:p_fa}
 \end{align} \cite{
 %http://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=6061767
 }

 and given a desired $P_{fa}$ the threshold $\eta$ is given by

\begin{align}\label{eq:ed_threshold}
 \eta &= \frac{\left(Q^{-1}\left(P_{fa}\right)2\sqrt{N} + 2N\right)2\sigma_n^2}{N} \\
 \end{align} \cite{
 %http://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=6061767
 }
 
 \section{Energy detection in the frequency domain}
 Notice that our test statistic $\Lambda''(\vec{x})$ is an estimate of the average power of the signal $x$. By definition of the power spectral
 density, the integral over the power spectral density gives the expected average power. Therefore, once we have computed our power spectral density estimate, we can obtain an estimate of the average power (and therefore we have evaluated our test statistic $\Lambda''(\vec{x})$). This can then be directly compared to the threshold as given  in \cref{eq:ed_threshold}.

 Notice that if $x[n] \sim \mathcal{CN}(0, \sigma_n^2$ then the autocorrelation function $r_x[n] = \sigma_n^2\delta[n]$. Therefore the power spectral density of $\mathcal{P}_x(\omega) = \sum_{n=-\infty}^{\infty}r_x[n]e^{-jn\omega} = \sigma_n^2$; it is flat. In the case that we want to detect the presence of a signal in a certain frequency band with bandwidth $W$, we can make use of this characteristic. By summating the power spectral density $P_{x}(\omega)$ over that band we obtain an average power of $\frac{W}{2\pi}$ times the average power obtained by summating over the whole power spectral density. Therefore if we are to use the sum over the frequency band as a test statistic, we have to use the threshold in \cref{eq:ed_threshold} multiplied by the proportionality factor $\frac{W}{2\pi}$.


\end{document}
